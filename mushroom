# âœ… FIXED & ENHANCED TASK 9 â€” Mushroom Classification with Visuals

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.preprocessing import LabelEncoder
from sklearn.naive_bayes import GaussianNB
from sklearn.tree import DecisionTreeClassifier
from sklearn.metrics import confusion_matrix, accuracy_score, classification_report

# Load Dataset
df = pd.read_csv("Navy Bays_Mushroom Dataset.csv")

print("Columns in dataset:\n", df.columns.tolist())

# âœ… Automatically find correct target (the one that represents edible/poisonous)
target_col = [col for col in df.columns if 'poison' in col.lower() or 'class' in col.lower() or 'type' in col.lower()][0]
print("\nDetected Target Column:", target_col)

# Encode all categorical columns
encoder = LabelEncoder()
df = df.apply(encoder.fit_transform)

# Split into features and target
X = df.drop(target_col, axis=1)
y = df[target_col]

# Train-Test Split
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# Initialize Models
models = {
    "Naive Bayes": GaussianNB(),
    "Decision Tree": DecisionTreeClassifier(random_state=42)
}

results = {}

for name, model in models.items():
    model.fit(X_train, y_train)
    y_pred = model.predict(X_test)
    acc = accuracy_score(y_test, y_pred)
    results[name] = acc * 100
    
    print(f"\nðŸ“Š {name} Performance:")
    print("Accuracy:", round(acc*100, 2), "%")
    print("Classification Report:\n", classification_report(y_test, y_pred))

    # Confusion Matrix Visualization
    cm = confusion_matrix(y_test, y_pred)
    plt.figure(figsize=(4, 3))
    sns.heatmap(cm, annot=True, fmt='d', cmap='Greens')
    plt.title(f"{name} Confusion Matrix")
    plt.xlabel('Predicted')
    plt.ylabel('Actual')
    plt.show()

# Cross Validation Accuracy
for name, model in models.items():
    score = cross_val_score(model, X, y, cv=5).mean()
    print(f"{name} Cross-Validation Accuracy: {round(score*100, 2)}%")

# Accuracy Comparison Visualization
plt.figure(figsize=(5, 4))
plt.bar(results.keys(), results.values(), color=['skyblue', 'orange'])
plt.title("Model Accuracy Comparison - Mushroom Dataset")
plt.ylabel("Accuracy (%)")
plt.ylim(90, 100)
plt.grid(axis='y', linestyle='--', alpha=0.6)
plt.show()
